---
- name: Install uchiwa configuration for Apache
  template:
    src: uchiwa.conf.j2
    dest: '{{ uchiwa_httpd_conf }}'
  notify: restart httpd

- name: Create uchiwa htpasswd credentials
  htpasswd:
    path: "{{ uchiwa_proxy_htpasswd }}"
    name: "{{ item['username'] }}"
    password: "{{ item['password'] }}"
    owner: apache
    group: apache
    mode: 0640
  with_items: "{{ uchiwa_credentials }}"
  when: uchiwa_authentication == 'htpasswd'

- name: Configure default redirect
  copy:
    content: |
      RewriteRule ^/$ {{ uchiwa_path }} [R=302]
    dest: '{{ opstools_default_redirect_file }}'
    force: false
  notify: restart httpd
