---
#- name: Open rabbitmq port
#  firewalld: port=5672/tcp permanent=true state=enabled

- name: install all rpms
  yum: name=rabbitmq-server state=present

- name: start the service
  service: name=rabbitmq-server state=started enabled=yes 

- rabbitmq_plugin: names=rabbitmq_management state=enabled

- rabbitmq_vhost: name={{ sensu_rabbitmq_vhost }} state=present

# Add user to server and assign full access control on / vhost.
# The user doesn't have permission rules for other vhosts
- name: Configure rabbitmq permissions
  rabbitmq_user: user={{ sensu_rabbitmq_user }}
                 password={{ sensu_rabbitmq_password }}
                 vhost={{ sensu_rabbitmq_vhost }}
                 configure_priv=.*
                 read_priv=.*
                 write_priv=.*
                 state=present
  notify:
  - restart rabbitmq
